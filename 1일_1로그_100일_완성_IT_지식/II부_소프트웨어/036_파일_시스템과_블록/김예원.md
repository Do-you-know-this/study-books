# 2부. 소프트웨어

## 036. 파일 시스템과 블록

- 파일 시스템
  - 운영체제에서 하드 디스크, CD와 DVD, 다른 이동식 메모리 장치 같은 물리적인 저장 매체를 파일과 폴더의 계층 구조처럼 보이게 하는 부분
  - 논리적 구성과 물리적 구현 간의 분리를 보여주는 훌륭한 사례
  - 파일 시스템은 다양한 종류의 장치에 정보를 조직화하고 저장하지만, 운영체제는 모두 동일한 인터페이스로 표시함
  - 파일 시스템이 정보를 저장하는 방식은 실생활에 영향을 미칠 뿐더러 법적인 영향력도 가짐
    - '파일 제거하기'가 왜 해당 내용이 영원히 사라졌음을 의미하지 않는지 이해하기 위해서이기도 함
- 윈도우 파일 탐색기 / 맥OS 파인더
  - 최상위부터 시작하는 계층 구조를 보여줌
  - 폴더(folder)
    - 다른 폴더와 파일의 이름을 담고 있음
    - 유닉스 계열의 운영체제에서는 전통적으로 폴더 대신 디렉터리(directory)라는 용어를 사용함
  - 폴더는 조직화된 구조를 제공하는 반면, 파일은 문서, 사진, 음악, 스프레드시트, 웹페이지 등의 실질적인 내용을 담고 있음
  - 컴퓨터가 보유하는 모든 정보는 파일 시스템에 저장되고, 사용자는 파일 시스템을 통해 정보에 접근함
    - 여기에는 데이터뿐만 아니라 워드와 크롬 브라우저 같은 프로그램의 실행 파일, 라이브러리, 환경 설정 정보, 디바이스 드라이버, 운영체제 자체를 구성하는 파일들이 포함됨
    - 파일의 양은 놀라울만큼 많음 ex) 저자의 맥북에 파일이 90만개 넘게 있음
- 파일 시스템 역할
  - 정보를 관리하면서 애플리케이션이나 운영체제의 나머지 부분이 정보를 읽고 쓸 수 있도록 접근 가능하게 만듦
  - 파일에 대한 접근이 효율적으로 수행되고 서로 간섭하지 않도록 조정하는 역할을 하고, 데이터의 물리적인 위치를 계속 파악함
    - 각각의 데이터 조각을 반드시 서로 분리해 알 수 없는 이유로 섞이지 않도록 함 ex) 이메일의 일부가 스프레드시트나 납세 신고서에서 발견되지 않도록 함
    - 다수의 사용자를 지원하는 시스템
      - 프라이버시와 보안을 강하게 적용해서 한 사용자가 다른 사용자의 파일에 권한 없이 접근할 수 없게 함
      - 사용자마다 사용할 수 있는 공간의 용량에 한도를 부과할 수 있음
- 파일 시스템 서비스는 가장 낮은 레벨의 시스템 콜을 통해 사용할 수 있음
- 파일 시스템 서비스를 만들 때 공통적인 부분은 라이브러리에 제공되어 있어 프로그래밍하기 쉬움
- 보조 기억 장치 파일 시스템
  - 500GB 드라이브는 5천억 바이트를 담을 수 있다.
    - 하지만 드라이브 자체의 소프트웨어는 이것을 각각 1,000바이트 덩어리 또는 블록(block) 5억 개로 표시한다.
    - (실제 컴퓨터에서는 이 크기가 2의 거듭제곱 값이다.)
  - 작은 메일 메시지 같은 2,500바이트 크기의 파일은 1,000바이트짜리 블록 세 개에 저장된다. 두 개에 들어가기에는 너무 크고 세 개면 충분하다.
  - 파일 시스템은 한 파일이 사용하는 바이트를 다른 파일이 사용하는 바이트와 같은 블록에 저장하지 않는다.
  - 위 예에서 세 번째 블록의 500바이트는 사용되지 않았다. 이정도는 보조 기억 장치가 너무 저렴하기 때문에 괜찮다.
  - 이 파일에 대한 폴더 엔트리(folder entry)는 파일 이름, 크기, 생성되거나 변경된 날짜와 시간, 다른 각종 정보(권한, 파일 유형 등 운영체제에 따라 다른 정보)를 담고 있다.
    - 또한 그 파일이 드라이브 어디에 저장되어 있는지, 즉 5억 개의 블록 중 어느 것이 파일의 바이트를 담고 있는지 정보를 갖고 있다.
    - 파일의 위치 정보를 관리하는 방법은 다양한다.
      - 폴더 엔트리가 블록 번호 목록을 담고있음
      - 폴더 엔트리가 블록 번호 목록을 담고 있는 블록을 참조함
      - 폴더 엔트리가 첫 번째 블록 번호를 담고 있어서 차례로 두 번째 블록 번호, 다음 블록 번호를 계속해서 구함
  - 같은 파일을 나눠 담고 있는 블록들이 하드 드라이브에서 물리적으로 인접해 있지 않아도 됨
  - SSD의 물리적 구현은 크게 다르겠지만 하드 드라이브와 기본 아이디어는 같음
    - 하지만 SSD 장치는 하드 드라이브와는 다른 드라이버를 사용하며, 장치 자체에 정보가 어느 위치에 있는지 기억하기 위한 정교한 코드가 들어 있음
      - 이는 SSD 장치의 각 영역이 사용될 수 있는 횟수에 제한이 있기 때문임
      - 웨어 레벨링(ware leveling): SSD 내부 소프트웨어는 각 물리적 블록이 몇 번 사용되었는지 파악하고, 각 블록이 거의 같은 횟수로 사용되도록 데이터를 옮김
  - 프로그램이 기존 파일에 접근하려 할 때, 파일 시스템은 계층 구조의 최상위부터 시작해서 파일 경로명의 각 요소를 해당하는 폴더에서 찾으면서 파일을 검색해야 함
    - 이 방식은 효율적인 전략임
    - 경로에서 폴더를 찾아 들어갈 때마다 그 폴더 이하에 있는 파일과 폴더에 수행되는 검색의 범위가 좁아지기 때문
    - 여러 파일이 경로의 일부를 공유할 수는 있지만 전체 경로명이 유일무이해야 한다는 조건을 반드시 충족해야 함
    - 실제로는 프로그램과 운영체제가 현재 사용되는 폴더를 계속 파악하기 때문에 검색이 매번 최상위에서 시작할 필요는 없음. 또한 시스템이 작업 속도를 높이기 위해 자주 사용되는 폴더를 캐싱하기도 함
- 파일 시스템은 새로운 블록에 대한 요청이 도착하면 미사용 블록(free block)의 목록에서 가져온 블록으로 요청을 만족시킴
- 파일 시스템에서 관리하는 미사용 블록 목록에는 운영체제만 접근할 수 있고 애플리케이션은 접근할 수 없음
